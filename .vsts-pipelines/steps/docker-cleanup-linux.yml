parameters:
  remoteDockerCleanupImage: null
steps:
  ################################################################################
  # Cleanup Remote Docker
  ################################################################################
  - ${{ if ne(parameters.remoteDockerCleanupImage, 'null') }}:
    - script: docker run --rm $(dockerArmRunArgs) --entrypoint docker $remoteDockerCleanupImage system prune -a -f --volumes
      displayName: Cleanup ARM Docker
      condition: always()
      continueOnError: true
      env:
        remoteDockerCleanupImage: ${{ parameters.remoteDockerCleanupImage }}
    # Don't stop any running containers as multiple build agents are used on a single host machine for remote docker scenarios
    - script: docker system prune -a -f --volumes

  ################################################################################
  # Cleanup Local Docker
  ################################################################################
  - ${{ if eq(parameters.remoteDockerCleanupImage, 'null') }}:
    - script: $(Build.Repository.LocalPath)/scripts/cleanup-docker.sh
      displayName: Cleanup Docker
      condition: always()
      continueOnError: true
