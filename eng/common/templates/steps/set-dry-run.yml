parameters:
  name: publishConfig
  type: object

steps:
- powershell: |
    if ("$env:ONEESPT_BUILDTYPE" -eq "Unofficial")
    {
      # Don't use dry-run mode for unofficial builds, since they publish to a
      # non-production environment
      $dryRunArg=""
    }
    elseif ("$(System.TeamProject)" -eq "$(publicProjectName)")
    {
      # Public builds need to use dry-run mode since they don't publish anywhere.
      $dryRunArg="--dry-run"
    }
    elseif (-not "$(officialRepoPrefixes)".Split(',').Contains("${{ parameters.publishConfig.publishAcr.repoPrefix }}"))
    {
      # If we're running an internal build on an official pipeline but not
      # publishing to an official repo prefix, then use dry run mode.
      $dryRunArg="--dry-run"
    }
    else
    {
      $dryRunArg=""
    }

    echo "##vso[task.setvariable variable=dryRunArg]$dryRunArg"
  displayName: Set dry-run arg for non-prod
