steps:
- powershell: |
    $imageBuilderBuildArgs = $env:IMAGEBUILDERBUILDARGS
    # Disable platform checks for CBL-Mariner on ARM64 due to https://github.com/dotnet/dotnet-docker/issues/3520
    # Similar issue with Ubuntu images in ACR missing the arch variant metadata
    $isUbuntu = "$(osVersions)".Contains("bionic") -or "$(osVersions)".Contains("focal") -or "$(osVersions)".Contains("jammy")
    if (("$(osVersions)".Contains("cbl-mariner") -and "$(architecture)" -eq "arm64") -or
        ($isUbuntu -and "$(architecture)".Contains("arm"))) {
      $imageBuilderBuildArgs += " --skip-platform-check"
    }

    echo "##vso[task.setvariable variable=imageBuilderBuildArgs]$imageBuilderBuildArgs"
  displayName: Set Custom ImageBuilder Build Args
