parameters:
# Whether this is an official or unofficial pipeline
- name: official
  type: boolean
  default: false
# BAR build channel to read .NET versions from
- name: channel
  type: string
  default: ""
# .NET image components to update. This should be a list of strings.
# 'stringList' is not a supported type for parameters in templates, so we need use 'object' instead.
# https://learn.microsoft.com/azure/devops/pipelines/process/runtime-parameters#parameter-data-types
- name: tools
  type: object
  default: []
# Additional authentication arguments to pass to update-dependencies
- name: gitHubAuthArgs
  type: string
  default: ""

extends:
  template: /eng/common/templates/1es.yml@self
  parameters:
    stages:
    - stage: UpdateDepsStage
      displayName: Update dependencies

      jobs:
      - template: /eng/pipelines/jobs/update-dependency.yml@self
        parameters:
          dependencyName: dotnet
          updateSteps:
          - task: AzureCLI@2
            displayName: Update Dotnet
            inputs:
              azureSubscription: "Darc: Maestro Production"
              scriptType: "pscore"
              scriptLocation: "inlineScript"
              inlineScript: >-
                dotnet run --project eng/update-dependencies/update-dependencies.csproj --
                from-channel
                ${{ parameters.channel }}
                https://github.com/dotnet/dotnet
                --version-source-name 'dotnet/dotnet'
                ${{ parameters.gitHubAuthArgs }}

      - ${{ each tool in parameters.tools }}:
        - template: /eng/pipelines/jobs/update-dependency.yml@self
          parameters:
            dependencyName: ${{ tool }}
            updateSteps:
            - powershell: >-
                dotnet run --project eng/update-dependencies/update-dependencies.csproj --
                specific 9.0
                --tool ${{ tool }}
                --version-source-name ${{ tool }}
                ${{ parameters.gitHubAuthArgs }}
              displayName: Update ${{ tool }}
