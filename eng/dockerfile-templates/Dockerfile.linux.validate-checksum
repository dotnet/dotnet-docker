{{
    _ Verify the checksum of a file on disk against a known value or a checksum file.

    ARGS:
        Required by all option groups:
        sha-function        : SHA function to use (e.g. 256, 384, 512), not optional.

        The following argument groups are mutually exclusive:

        file                : Path to the file to validate.
        sha                 : Expected checksum of the downloaded file.
        sha-var-name        : (optional) Name of variable to store the checksum in. If not provided,
                              the checksum will be written inline with the call to the sha*sum check
                              tool.

        sha-file            : Checksum file to validate against. The file should contain a single
                              line with the expected checksum and the file name to validate,
                              separated by one or two spaces. See `man cksum` or `man sha512sum` for
                              details.

        sha-file-aggregate  : File containing a list of checksums. The file may contain one or more
                              lines with expected checksums and file names separated by one or two
                              spaces. One line must have a filename matching the file you wish to
                              validate. See `man cksum` or `man sha512sum` for details.
        ^

    set isAlpine to find(OS_VERSION, "alpine") >= 0 ^

    set shaValue to when(ARGS["sha-var-name"],
        cat("$", ARGS["sha-var-name"]),
        ARGS["sha"])

}}{{
if ARGS["sha"]:{{if ARGS["sha-var-name"]:{{ARGS["sha-var-name"]}}='{{ARGS["sha"]}}' \
&& }}echo "{{shaValue}}  {{ARGS["file"]}}" | sha{{ARGS["sha-function"]}}sum -c -^
elif (ARGS["sha-file"])
    :sha{{ARGS["sha-function"]}}sum -c {{ARGS["sha-file"]}}^
elif (ARGS["sha-file-aggregate"])
    :if (isAlpine)
        :awk -v file="{{ARGS["file"]}}" '{gsub(/\r/, "")} $2 == file' ${{ARGS["sha-file-aggregate"]}} | sha512sum -c^
    else
        :sha512sum --ignore-missing --check {{ARGS["sha-file"]}}}}
